<!DOCTYPE html>
<html lang="en">
<head>
    
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>My Tickets</title>

<style>
*{
    margin:0;
    padding:0;
    box-sizing:border-box;
    font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Helvetica,Arial,sans-serif;
}

body{
    background:#f3f3f3;
}

/* ================= HEADER ================= */
.header{
    background:#000;
    color:#fff;
    padding:16px;
    display:flex;
    justify-content:space-between;
    align-items:center;
    top:0;
}

.header h2{
    font-size:18px;
    font-weight:600;
}

.header .left,
.header .right{
    font-size:15px;
    opacity:0.85;
}

/* ================= TABS ================= */
.tabs{
    background:#000;
    color:#999;
    display:flex;
    justify-content:space-around;
    font-size:14px;
}

.tabs div{
    padding:12px 0;
    width:50%;
    text-align:center;
}

.tabs .active{
    color:#fff;
    border-bottom:2px solid #fff;
}

/* ================= TICKET WRAPPER ================= */
.ticket-section{
    padding:16px;
}

.ticket-card{
    background:#fff;
    border-radius:16px;
    overflow:hidden;
    box-shadow:0 4px 12px rgba(0,0,0,0.08);
}

/* ===== TOP BLUE ===== */
.ticket-top{
    background:#2e57e8;
    color:#fff;
    padding:18px;
    position:relative;
}

.ticket-top .info-icon{
    position:absolute;
    right:16px;
    top:16px;
    font-size:14px;
}

.ticket-top .presale{
    font-size:14px;
    margin-bottom:18px;
    text-align: center;
}

.ticket-meta{
    display:flex;
    justify-content:space-between;
    text-align:center;
}

.ticket-meta div{
    flex:1;
    font-size:12px;
    opacity:0.9;
}

.ticket-meta strong{
    display:block;
    font-size:20px;
    margin-top:6px;
}

/* ===== IMAGE ===== */
.ticket-image{
    position:relative;
    height:200px;
}

.ticket-image img{
    width:100%;
    height:100%;
    object-fit:cover;
}

.ticket-overlay{
    position:absolute;
    inset:0;
    background:rgba(0,0,0,0.45);
    display:flex;
    flex-direction:column;
    justify-content:end;
    align-items:center;
    padding:20px;
    color:#fff;
}

.ticket-overlay h3{
    font-size:18px;
    font-weight:400;
    margin-bottom:10px;
    text-align:center;
}

.ticket-overlay p{
    font-size:12px;
}

/* ===== BODY ===== */
.ticket-body{
    padding:20px;
    text-align:center;
}

.ticket-body .gate{
    font-size:15px;
    margin-bottom:18px;
}

.view-btn{
    background:#000;
    color:#fff;
    width:100%;
    padding:14px;
    border:none;
    border-radius:1px;
    font-size:15px;
    margin-bottom:18px;
}

svg {
    
}

.ticket-details{
    font-size:14px;
    color:#666;
}

/* ===== DOTS ===== */
.dots{
    text-align:center;
    margin-top:12px;
}

.dots span{
    display:inline-block;
    width:8px;
    height:8px;
    background:#ccc;
    border-radius:50%;
    margin:0 4px;
}

.dots .active{
    background:#000;
}

/* ===== ACTION ROW ===== */
.actions{
    display:flex;
    padding:16px;
    gap:10px;
}

.actions button{
    flex:1;
    padding:14px;
    border-radius:6px;
    border:none;
    font-size:15px;
}

.transfer{
    background:#2e57e8;
    color:#fff;
}

.sell{
    background:#cfcfcf;
    color:#fff;
}

.orders{
    background:#2e57e8;
    color:#fff;
}

/* ===== MAP ===== */
.map img{
    width:100%;
    height:200px;
    object-fit:cover;
}

/* MAP */
.map{
    margin:15px;
    position:relative;
}

.map iframe{
    width:100%;
    height:200px;
    border-radius:18px;
}

/* ===== TRANSFER SHEET ===== */
.overlay{
    position:fixed;
    inset:0;
    background:rgba(0,0,0,0.5);
    opacity:0;
    pointer-events:none;
    transition:0.3s;
}

.overlay.active{
    opacity:1;
    pointer-events:auto;
}

.transfer-sheet{
    position:fixed;
    left:0;
    bottom:-100%;
    width:100%;
    height:50vh;
    background:#fff;
    border-radius:20px 20px 0 0;
    padding:20px;
    transition:0.3s;
    overflow-y:auto;
}

.transfer-sheet.active{
    bottom:0;
}

/* slider */
.ticket-slider{
    display:flex;
    gap:16px;
    overflow-x:auto;
    scroll-snap-type:x mandatory;
    -webkit-overflow-scrolling:touch;
}

.ticket-slider::-webkit-scrollbar{
    display:none;
}

.ticket-slider .ticket-card{
    min-width:100%;
    scroll-snap-align:center;
}
.ticket-section{
    padding:16px 0;
}

.ticket-slider{
    display:flex;
    gap:16px;
    overflow-x:auto;
    scroll-snap-type:x mandatory;
    -webkit-overflow-scrolling:touch;
    padding:0 16px;
}

.ticket-slider::-webkit-scrollbar{
    display:none;
}

.ticket-slider .ticket-card{
    flex:0 0 85%;
    scroll-snap-align:center;
    transition:transform 0.3s ease;
}

/* ===== TRANSFER UI EXACT STYLE ===== */

.transfer-sheet{
    position:fixed;
    left:0;
    bottom:-100%;
    width:100%;
    height:65vh;
    background:#f4f4f4;
    border-radius:20px 20px 0 0;
    transition:0.3s ease;
    display:flex;
    flex-direction:column;
}

.transfer-sheet.active{
    bottom:0;
}

.transfer-header{
    text-align:center;
    padding:16px;
    background:#fff;
    font-weight:600;
    border-bottom:1px solid #ddd;
}

.transfer-content{
    padding:16px;
    overflow-y:auto;
    flex:1;
}

.ticket-count{
    font-size:15px;
    margin-bottom:6px;
}

.ticket-meta-info{
    font-size:14px;
    margin-bottom:18px;
    color:#444;
}

.transfer-content label{
    display:block;
    font-size:14px;
    margin-bottom:6px;
    margin-top:12px;
}

.transfer-content input,
.transfer-content textarea{
    width:100%;
    padding:12px;
    border:1px solid #ccc;
    border-radius:4px;
    font-size:14px;
    background:#fff;
}

.transfer-footer{
    background:#fff;
    padding:14px 16px;
    display:flex;
    justify-content:space-between;
    align-items:center;
    border-top:1px solid #ddd;
}

.back-btn{
    font-size:14px;
    color:#2e57e8;
    font-weight:500;
}

.confirm-transfer{
    background:#2e57e8;
    color:#fff;
    border:none;
    padding:12px 18px;
    border-radius:6px;
    font-size:14px;
}

.ticket-seats{
    margin-top:15px;
    display:flex;
    flex-direction:column;
    gap:10px;
}

.seat-option{
    display:flex;
    align-items:center;
    gap:10px;
    font-size:14px;
}

.seat-option input{
    width:18px;
    height:18px;
}

.ticket-seats{
    margin-top:15px;
    display:flex;
    gap:10px;
    flex-wrap:wrap;
}

.seat-pill{
    padding:8px 14px;
    border-radius:20px;
    background:#f0f0f0;
    font-size:13px;
    cursor:pointer;
    transition:0.2s ease;
    border:1px solid transparent;
}

.seat-pill.selected{
    background:#2e57e8;
    color:#fff;
    border-color:#2e57e8;
}

.ticket-card.selected {
    outline: 3px solid #2e57e8;
    transform: scale(0.98);
}

/* View tickets styling */
.view-btn {
    background: #000;
    color: #fff;
    width: 100%;
    padding: 14px;
    border: none;
    border-radius: 6px;
    font-size: 15px;
    font-weight: 200;
    display: flex;
    gap: 10px;
    align-items: center;
    justify-content: center;
}

.view-btn .scan-icon {
    width: 20px;
    height: 20px;
}
</style>
</head>

<body>

<div class="header">
    <div class="left">✕</div>
    <h2>My Tickets</h2>
    <div class="right">Help</div>
</div>

<div class="tabs">
    <div class="active">MY TICKETS</div>
    <div>ADD-ONS</div>
    <div id="addonsPanel" style="display:none; padding:16px;">

    <h3 style="margin-bottom:10px;">Add / Edit Ticket</h3>

    <input type="text" id="secInput" placeholder="Section" style="width:100%;padding:10px;margin-bottom:8px;">
    <input type="text" id="rowInput" placeholder="Row" style="width:100%;padding:10px;margin-bottom:8px;">
    <input type="text" id="seatInput" placeholder="Seat (comma separated)" style="width:100%;padding:10px;margin-bottom:8px;">
    <input type="text" id="gateInput" placeholder="Gate" style="width:100%;padding:10px;margin-bottom:8px;">
    <input type="text" id="overlayTitleInput" placeholder="Overlay Title" style="width:100%;padding:10px;margin-bottom:8px;">
    <input type="text" id="overlayTextInput" placeholder="Overlay Text" style="width:100%;padding:10px;margin-bottom:8px;">
    <input type="text" id="imageInput" placeholder="Image URL" style="width:100%;padding:10px;margin-bottom:12px;">

    <button onclick="saveTicket()" style="width:100%;padding:12px;background:#2e57e8;color:#fff;border:none;border-radius:6px;">
        Save Ticket
    </button>

    <button onclick="deleteTicket()" 
        style="width:100%;padding:12px;background:#ff3b30;color:#fff;border:none;border-radius:6px;margin-top:8px;">
        Delete Ticket
    </button>
</div>
</div>

<div class="ticket-section">

<div class="ticket-slider" id="ticketSlider">
    <!-- Tickets render here -->
</div>

</div>

<div class="dots" id="dots">
    <span class="active"></span>
    <span></span>
    <span></span>
</div>

</div>

<div class="actions">
    <button class="transfer">Transfer</button>
    <button class="sell">Sell</button>
    <button class="orders">Orders</button>
</div>

<div class="map">
    <iframe src="https://www.google.com/maps?q=Estadio+Riyadh+Air+Metropolitano&output=embed"></iframe>
</div>

<div id="overlay" class="overlay" onclick="closeTransfer()"></div>

<div id="sheet" class="transfer-sheet">

    <div class="transfer-header">
        <h3>TRANSFER TICKETS</h3>
    </div>

    <div class="transfer-content">

        <div class="ticket-count" id="selectedCount"></div>

        <div class="ticket-meta-info">
            Sec <strong id="selectedSec"></strong>,
            Row <strong id="selectedRow"></strong>,
            Seat <strong id="selectedSeat"></strong>
        </div>

        <label>First Name</label>
        <input type="text" id="firstName" placeholder="First Name">

        <label>Last Name</label>
        <input type="text" id="lastName" placeholder="Last Name">

        <label>Email or Mobile Number</label>
        <input type="text" id="contact" placeholder="Email or Mobile Number">

        <label>Note</label>
        <textarea id="note" rows="4"></textarea>

    </div>

    <div class="transfer-footer">
        <div class="back-btn" onclick="closeTransfer()">← BACK</div>
        <button class="confirm-transfer" onclick="submitTransfer()">Transfer 2 Tickets</button>
    </div>

</div>

<script>

/* ================= GLOBAL STATE ================= */

let tickets = JSON.parse(localStorage.getItem("myTickets")) || [];
let selectedTickets = [];
let editingId = null;

const slider = document.getElementById("ticketSlider");
const dotsContainer = document.getElementById("dots");
const transferBtn = document.querySelector(".transfer");

/* ================= RENDER TICKETS ================= */

function renderTickets(){

    slider.innerHTML = "";
    dotsContainer.innerHTML = "";
    selectedTickets = [];

    tickets.forEach((ticket, index) => {

        const card = document.createElement("div");
        card.className = "ticket-card";
        card.dataset.id = ticket.id;

        card.innerHTML = `
            <div class="ticket-top">
                <div class="presale">
                    Artist Presale
                    <span class="info-icon">ⓘ</span>
                </div>

                <div class="ticket-meta">
                    <div>SEC<strong>${ticket.section}</strong></div>
                    <div>ROW<strong>${ticket.row}</strong></div>
                    <div>SEAT<strong>${ticket.seat}</strong></div>
                </div>
            </div>

            <div class="ticket-image">
                <img src="${ticket.image}">
                <div class="ticket-overlay">
                    <h3>${ticket.overlayTitle}</h3>
                    <p>${ticket.overlayText}</p>
                </div>
            </div>

            <div class="ticket-body">
                <div class="gate">${ticket.gate}</div>
                <button class="view-btn">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-upc-scan" viewBox="0 0 16 16">
                        <path d="M1.5 1a.5.5 0 0 0-.5.5v3a.5.5 0 0 1-1 0v-3A1.5 1.5 0 0 1 1.5 0h3a.5.5 0 0 1 0 1zM11 .5a.5.5 0 0 1 .5-.5h3A1.5 1.5 0 0 1 16 1.5v3a.5.5 0 0 1-1 0v-3a.5.5 0 0 0-.5-.5h-3a.5.5 0 0 1-.5-.5M.5 11a.5.5 0 0 1 .5.5v3a.5.5 0 0 0 .5.5h3a.5.5 0 0 1 0 1h-3A1.5 1.5 0 0 1 0 14.5v-3a.5.5 0 0 1 .5-.5m15 0a.5.5 0 0 1 .5.5v3a1.5 1.5 0 0 1-1.5 1.5h-3a.5.5 0 0 1 0-1h3a.5.5 0 0 0 .5-.5v-3a.5.5 0 0 1 .5-.5M3 4.5a.5.5 0 0 1 1 0v7a.5.5 0 0 1-1 0zm2 0a.5.5 0 0 1 1 0v7a.5.5 0 0 1-1 0zm2 0a.5.5 0 0 1 1 0v7a.5.5 0 0 1-1 0zm2 0a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 .5.5v7a.5.5 0 0 1-.5.5h-1a.5.5 0 0 1-.5-.5zm3 0a.5.5 0 0 1 1 0v7a.5.5 0 0 1-1 0z"/>
                    </svg>
                    View Ticket
                </button>
                <div class="ticket-details">
                    Ticket Details
                </div>
            </div>
        `;

        card.addEventListener("click", () => toggleSelect(ticket.id));
        card.addEventListener("dblclick", () => editTicket(ticket.id));

        slider.appendChild(card);

        const dot = document.createElement("span");
        if(index === 0) dot.classList.add("active");
        dotsContainer.appendChild(dot);
    });

    updateTransferButton();
}

/* ================= CAROUSEL DOT SYNC ================= */

slider.addEventListener("scroll", () => {
    const cards = document.querySelectorAll(".ticket-card");
    const dots = document.querySelectorAll("#dots span");

    if (!cards.length) return;

    const cardWidth = cards[0].offsetWidth;
    const scrollLeft = slider.scrollLeft;

    // Calculate closest index
    const index = Math.round(scrollLeft / cardWidth);

    dots.forEach((dot, i) => {
        dot.classList.toggle("active", i === index);
    });
});

/* ================= SELECT TICKETS ================= */

function toggleSelect(id){

    if(selectedTickets.includes(id)){
        selectedTickets = selectedTickets.filter(t => t !== id);
    } else {
        selectedTickets.push(id);
    }

    document.querySelectorAll(".ticket-card").forEach(card => {
        card.classList.toggle(
            "selected",
            selectedTickets.includes(Number(card.dataset.id))
        );
    });

    updateTransferButton();
}

function updateTransferButton(){

    if(selectedTickets.length === 0){
        transferBtn.innerText = "Transfer";
    } else if(selectedTickets.length === 1){
        transferBtn.innerText = "Transfer 1 Ticket";
    } else {
        transferBtn.innerText = `Transfer ${selectedTickets.length} Tickets`;
    }
}

/* ================= TRANSFER ================= */

transferBtn.addEventListener("click", openTransfer);

function openTransfer(){

    if(selectedTickets.length === 0){
        alert("Please select at least one ticket.");
        return;
    }

    const selected = tickets.filter(t => selectedTickets.includes(t.id));

    document.getElementById("selectedCount").innerText =
        `${selected.length} Ticket${selected.length > 1 ? "s" : ""} Selected`;

    document.getElementById("selectedSec").innerText =
        [...new Set(selected.map(t => t.section))].join(", ");

    document.getElementById("selectedRow").innerText =
        [...new Set(selected.map(t => t.row))].join(", ");

    document.getElementById("selectedSeat").innerText =
        selected.map(t => t.seat).join(", ");

    document.getElementById("overlay").classList.add("active");
    document.getElementById("sheet").classList.add("active");

    document.querySelector(".confirm-transfer").innerText =
        `Transfer ${selected.length} Ticket${selected.length > 1 ? "s" : ""}`;
}

function closeTransfer(){
    document.getElementById("overlay").classList.remove("active");
    document.getElementById("sheet").classList.remove("active");
}

function submitTransfer(){

    const first = document.getElementById("firstName").value;
    const last = document.getElementById("lastName").value;
    const contact = document.getElementById("contact").value;

    if(!first || !last || !contact){
        alert("Please fill all required fields.");
        return;
    }

    const selected = tickets.filter(t => selectedTickets.includes(t.id));

    localStorage.setItem("transferName", first + " " + last);
    localStorage.setItem("transferContact", contact);
    localStorage.setItem("transferTickets", JSON.stringify(selected));

    window.location.href = "transfer-success.html";
}

/* ================= ADD / EDIT ================= */

function saveTicket(){

    const sec = document.getElementById("secInput").value;
    const row = document.getElementById("rowInput").value;
    const seat = document.getElementById("seatInput").value;
    const gate = document.getElementById("gateInput").value;
    const title = document.getElementById("overlayTitleInput").value;
    const text = document.getElementById("overlayTextInput").value;
    const image = document.getElementById("imageInput").value;

    if(!sec || !row || !seat){
        alert("Section, Row and Seat required.");
        return;
    }

    const newTicket = {
        id: editingId || Date.now(),
        section: sec,
        row: row,
        seat: seat,
        gate: gate,
        overlayTitle: title,
        overlayText: text,
        image: image || "https://via.placeholder.com/400x200"
    };

    if(editingId){
        tickets = tickets.map(t => t.id === editingId ? newTicket : t);
    } else {
        tickets.push(newTicket);
    }

    localStorage.setItem("myTickets", JSON.stringify(tickets));

    editingId = null;
    clearForm();
    renderTickets();
}

function editTicket(id){

    const ticket = tickets.find(t => t.id === id);
    editingId = id;

    document.getElementById("secInput").value = ticket.section;
    document.getElementById("rowInput").value = ticket.row;
    document.getElementById("seatInput").value = ticket.seat;
    document.getElementById("gateInput").value = ticket.gate;
    document.getElementById("overlayTitleInput").value = ticket.overlayTitle;
    document.getElementById("overlayTextInput").value = ticket.overlayText;
    document.getElementById("imageInput").value = ticket.image;
}

function deleteTicket(){

    if(!editingId){
        alert("Double-click a ticket to edit/delete.");
        return;
    }

    if(!confirm("Delete this ticket?")) return;

    tickets = tickets.filter(t => t.id !== editingId);
    localStorage.setItem("myTickets", JSON.stringify(tickets));

    editingId = null;
    clearForm();
    renderTickets();
}

function clearForm(){
    document.getElementById("secInput").value = "";
    document.getElementById("rowInput").value = "";
    document.getElementById("seatInput").value = "";
    document.getElementById("gateInput").value = "";
    document.getElementById("overlayTitleInput").value = "";
    document.getElementById("overlayTextInput").value = "";
    document.getElementById("imageInput").value = "";
}

/* ================= TABS ================= */

const tabs = document.querySelectorAll(".tabs div");
const addonsPanel = document.getElementById("addonsPanel");

tabs[0].addEventListener("click", () => {
    tabs[0].classList.add("active");
    tabs[1].classList.remove("active");
    addonsPanel.style.display = "none";
});

tabs[1].addEventListener("click", () => {
    tabs[1].classList.add("active");
    tabs[0].classList.remove("active");
    addonsPanel.style.display = "block";
});

/* ================= CLOSE X ================= */

document.querySelector(".left").addEventListener("click", () => {
    window.location.href = "index.html";
});

/* ================= INIT ================= */

renderTickets();

</script>
</body>
</html>